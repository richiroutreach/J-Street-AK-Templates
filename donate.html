{% extends "./wrapper.html" %}{% load actionkit_tags %}{% load smartif %}

{% block content %}
<!-- @START Development Template/donate.html -->
<script language="javascript">
	function clear_radio_buttons() {
		$('input.amount_radio_button').attr('checked', false);
	}

	function clear_other() {
		$('#amount_other_field').val("");
	}

	var address_fields = [ 'address1', 'addressdesk2', 'city','state', 'zip' {% if page.allow_international %},'postal', 'region', 'country'{% endif %} ];

	function toggle_shipping(e) {
		for (i in address_fields) {
			field = address_fields[i];

			if (e.checked) {
				$('#shipping_' + field).val($('#' + field).val());
				$('#id_shipping_state').val($('#id_state').val());
				$('#shipping_' + field).attr("readonly", true);
			} else {
				$('#shipping_' + field).val("");
				$('#id_shipping_state').val("");
				$('#shipping_' + field).attr("readonly", false);
			}
		}

		{% if page.allow_international %}
			shipping_country_change();
		{% endif %}
	}

	function sync_to_shipping(e) {
		if (!$('#shipping_same').attr("checked"))
			return;

		for (i in address_fields) {
			field = address_fields[i];

			$('#shipping_' + field).val($('#' + field).val());
			$('#id_shipping_state').val($('#id_state').val());
		}

		{% if page.allow_international %}
			shipping_country_change();
		{% endif %}
	}

	function update_total() {
		var total = 0.0;

		$('.ak_product_inputs').each(function (i) {
			// max == 1 produces checkboxes for these
			if (this.type == "checkbox" && !this.checked)
				return;

			// check that quantity is a valid int
			var quantity = this.value;

			if (quantity.length == 0 || !/^[1-9]\d*$/.test(quantity))
				return;

			// and price is a valid dollar amount
			var price = $('#' + this.id + '_price').text();

			// Remove any currency formatting
			price = Number(price.replace(/[^0-9\.]+/g,""));

			if (price.length == 0 || !/^[1-9]\d*(\.\d\d)?$/.test(price))
				return;

			total += parseInt(quantity) * parseFloat(price);
		});

		$('.ak_candidate_inputs').each(function (i) {
			// check that amount is a valid amount
			var amount = this.value;

			if (amount.length == 0 || !/^[0-9]\d*(\.\d\d)?$/.test(amount))
				return;

			total += parseFloat(amount);
		});

		// look for checked off donation amounts
		var amount_checked = $('input:radio[name=amount]:checked').val(); 

		if (amount_checked) {
			total += parseFloat(amount_checked);
		} else {
			// or other amounts
			var other = $('#amount_other_field').val();

			if (other && /^[0-9]\d*(\.\d{2})?$/.test(other))
				total += parseFloat(other);
		}

		// Set the amount so GA can easily get it
		$('#ga-amount').val(total.toFixed(2));

		var new_total = total == 0 ? "" : '$' + total.toFixed(2);

		if (new_total != $('#total').html()) {
			$('#total').html(new_total);
		}
	}

	{% if page.allow_international %}
		function country_change() {
			country = $('#country').val();

			if (country == 'United States') {
				$('#us_billing_fields').show();
				$('#intl_billing_fields').hide();
			} else {
				$('#us_billing_fields').hide();
				$('#intl_billing_fields').show();
			}

			sync_to_shipping();
		}

		function shipping_country_change() {
			shipping_country = $('#shipping_country').val();

			if (shipping_country == 'United States') {
				$('#us_shipping_fields').show();
				$('#intl_shipping_fields').hide();
			} else {
				$('#us_shipping_fields').hide();
				$('#intl_shipping_fields').show();
			}
		}
	{% endif %}
</script>


{% comment %}
	/*
-------------------------------------------------------------------------------
		@START - Google Analytics Tracking
-------------------------------------------------------------------------------
	*/
{% endcomment %}
<script>
	/*
		Function to make GA events for problems during donating
	*/
	function logValidationErrors() {
		$('#ak-errors li').each(function() {
			var errorMessage = $(this).html();

			if(errorMessage.length > 0 && errorMessage != "For your security, your card number has been cleared.") {
				if(knownUser) {
					ga( 'send', 'event', 'Validation Error', '{{ user.email }}', errorMessage, {{ page.id }} );
				} else if ( $('#email').val() != "" ) {
					ga( 'send', 'event', 'Validation Error', $('#email').val(), errorMessage, {{ page.id }} );
				} else {
					ga( 'send', 'event', 'Validation Error', 'Unknown User', errorMessage, {{ page.id }} );
				}
				
				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Validation Error', $.cookie('user') + ': ' + errorMessage + " on {{ page.id }}", {{ page.id }} );			
					ga( 'send', 'event', 'Cookie', $.cookie('user'), 'Validation Error: ' + errorMessage + " on {{ page.id }}", {{ page.id }} );			
				}				
			}
		});
	}

	$(document).ready(function() {
		// Set up tracking events on form submit
		$('#act').submit(function() {
			{% if page.custom_fields.splash_page %}
				if( $(this).valid() ) {
			{% endif %}
				if(knownUser) {
					ga('send', 'event', 'Submission Attempt', '{{ user.email }}', 'Amount (' + $('#ga-amount').val() + ')', {{ page.id }});
					ga('send', 'event', 'Submission Attempt', '{{ user.email }}', 'Type (' + $('input[name="donation_type"]:checked').val() + ')', {{ page.id }});	
				} else if ( $('#email').val() != "" ) {
					ga('send', 'event', 'Submission Attempt', $('#email').val(), 'Amount (' + $('#ga-amount').val() + ')', {{ page.id }});
					ga('send', 'event', 'Submission Attempt', $('#email').val(), 'Type (' + $('input[name="donation_type"]:checked').val() + ')', {{ page.id }});	
				} else {
					ga('send', 'event', 'Submission Attempt', 'Unknown User', 'Amount (' + $('#ga-amount').val() + ')', {{ page.id }});
					ga('send', 'event', 'Submission Attempt', 'Unknown User', 'Type (' + $('input[name="donation_type"]:checked').val() + ')', {{ page.id }});
				}

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga('send', 'event', 'Cookie', 'Submission Attempt', $.cookie('user') + ' on {{ page.id }} for ' + $('#ga-amount').val() + ' (' + $('input[name="donation_type"]:checked').val() + ')');
					ga('send', 'event', 'Cookie', $.cookie('user'), 'Submission Attempt on {{ page.id }} for ' + $('#ga-amount').val() + ' (' + $('input[name="donation_type"]:checked').val() + ')');
				}
			{% if page.custom_fields.splash_page %}
				}
			{% endif %}
		});

		// Set up tracking for donation type change
		$('input[name="donation_type"]').change(function() {
			if( $(this).is(':checked') ) {
				if(knownUser) {
					ga( 'send', 'event', 'Form Interaction', '{{ user.email }}', 'Type Changed (' + $(this).val() + ')', {{ page.id }} );
				} else if ( $('#email').val() != "" ) {
					ga( 'send', 'event', 'Form Interaction', $('#email').val(), 'Type Changed (' + $(this).val() + ')', {{ page.id }} );
				} else {
					ga('send', 'event', 'Form Interaction', 'Unkown User', 'Type Changed ('+ $(this).val() + ')', {{ page.id }} );
				}			

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Form Interaction', 'Type Changed (' + $.cookie('user') + ' to ' + $(this).val() + ')', {{ page.id }});
					ga( 'send', 'event', 'Cookie', $.cookie('user'),  'Type Changed to ' + $(this).val() + ' on {{ page.id }}', {{ page.id }});
				}
			}
		});

		// Track "next" button clicked
		$('.next').click(function() {
			var page = $(this).data('page');
			{% if page.custom_fields.splash_page %}
				if($('#act').valid()) {
			{% endif %}
				if(knownUser) {
					ga('send', 'event', 'Form Interaction', '{{ user.email }}', 'Next Pressed (' + (page - 1) + ')');
				} else if ( $('#email').val() != "" ) {
					ga('send', 'event', 'Form Interaction', $('#email').val(), 'Next Pressed (' + (page - 1) + ')');
				} else {
					ga('send', 'event', 'Form Interaction', 'Unknown User', 'Next Pressed (' + (page - 1) + ')');
				}

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Form Interaction', 'Next Pressed (' + $.cookie('user') + ' on {{ page.id }})', {{ page.id }});
					ga( 'send', 'event', 'Cookie', $.cookie('user'),  'Form Interfaction - Next Pressed {{ page.id }}', {{ page.id }});			
				}
			{% if page.custom_fields.splash_page %}
				} else {
			{% endif %}
				logValidationErrors();

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Form Interaction', 'Next Pressed w/ Errors (' + $.cookie('user') + ' on {{ page.id }})', {{ page.id }});
					ga( 'send', 'event', 'Cookie', $.cookie('user'),  'Form Interfaction - Next Pressed w/ Errors {{ page.id }}', {{ page.id }});			
				}
			{% if page.custom_fields.splash_page %}
				}
			{% endif %}
		});

		// Track "prev" button clicked
		$('.prev').click(function() {
			var page = $(this).data('page');

			if(knownUser) {
				ga('send', 'event', 'Form Interaction', '{{ user.email }}', 'Back Pressed (' + (page + 1) + ')');
			} else if ( $('#email').val() != "" ) {
				ga('send', 'event', 'Form Interaction', $('#email').val(), 'Back Pressed (' + (page + 1) + ')');
			} else {
				ga('send', 'event', 'Form Interaction', 'Unknown User', 'Back Pressed (' + (page + 1) + ')');
			}
		});

		// Log any errors that AK spits back
		window.setTimeout(function() {
			logValidationErrors();
		}, 500);
	});
</script>
{% comment %}
	/*
-------------------------------------------------------------------------------
		@END - Google Analytics Tracking
-------------------------------------------------------------------------------
	*/
{% endcomment %}



{% comment %}
	/*
-------------------------------------------------------------------------------
		@START - Custom Page Functions JS
-------------------------------------------------------------------------------
	*/
{% endcomment %}
<script>
	/*
		Load custom fields from URL
	*/
	window.setTimeout( function() {
		// Contributing Member
		if( getURLParameter( 'action_contributing_member' ) == 1 ) {
			$( '#contributing_member_yes' ).prop( 'checked', true );
			$( '#jstreet-chapters' ).fadeIn( 300 );
		}
	}, 500);

	$( document ).ready( function() {
		// Contributing Member Functions
		$('input[name="user_contributing_member"]').trigger('change');

		/*
			Show / Hide the contributing member drop down
		*/
		$( 'input[name="user_contributing_member"]' ).change( function() {
			if( $( this ).is( ':checked' ) && $( this ).data( 'value' ) == 'yes' ) {
				$( '#jstreet-chapters' ).fadeIn( 300 );
				$( '#action_contributing_member_field' ).val( '1' );

			} else {
				$( '#jstreet-chapters' ).fadeOut( 300 );
				$( '#action_contributing_member_field' ).val( '0' );
			}
		});

		// Make sure the two step boxes are the same height
		$( '.step-wrapper' ).matchHeight();
	});

	/*
		Get a parameter from the URL
	*/
	function getURLParameter(name) {
		return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
	}
</script>
{% comment %}
	/*
-------------------------------------------------------------------------------
		@END - Custom Page Functions JS
-------------------------------------------------------------------------------
	*/
{% endcomment %}


{% with page.payment_processor_information as pp %}
	{% if pp.use_cse %}
		<script language="javascript" src="/samples/ak_braintree_cse.js"></script>
		<script language="javascript" src="/media/js/braintree-cse.js"></script>

		<script type="text/javascript">
			$(function () {
				var form = $('form#act')[0];

				clientSideEncryptionKey = "{{ pp.cse_key }}";
				braintree_cse.encryptOnSubmit(form, clientSideEncryptionKey);

				$('form#act input[type=submit]').removeAttr('disabled');
			});
		</script>
	{% endif %}

	{% if pp.use_tr %}
		<script language="javascript" src="/samples/braintree.js"></script>
	{% endif %}
{% endwith %}

{% comment %}
	/*
		---------------------------------------------------------------
			START - Donation Form - Markup
		---------------------------------------------------------------
	*/
{% endcomment %}

<form id="act" name="act" class="{% if page.payment_processor_information.use_tr %}braintree_form{% endif %}" method="POST" action="/act/" accept-charset="utf-8">
	<input type="hidden" name="orig_akid" value="{{ akid }}">
	<input type="hidden" name="page" value="{{ page.name }}">

	{% if not page.allow_international %}
		<input type="hidden" name="country" value="United States">
	{% endif %}

	<div class="row">
		<div class="small-12 columns page-title">
			<h2>
				{{ page.title }}

				{% if page.custom_fields.page_subtitle %}
					<br><span class="subtitle">{{ page.custom_fields.page_subtitle }}</span>
				{% endif %}
			</h2>
		</div> <!-- .page-title -->
	</div> <!-- .row -->

	<div class="row hide-for-small desktop-ask">
		<div class="large-12 columns page-ask">
			{% include_tmpl form.ask_text %}
		</div> <!-- .page-ask -->
	</div> <!-- .desktop-petition -->

	<div class="row ak-error-wrapper">
		<div class="large 12 columns">
			<ul id="ak-errors" class="hidden"></ul>
		</div>
	</div> <!-- .ak-error-wrapper -->

	<div class="row">
		<div id="step-one" class="donate-step large-5 columns">
			<div class="step-wrapper">
				<h3 class="step-header">
					<span class="arrow"></span>Step 1</strong>: Select your donation
				</h3> <!-- .step-header -->

				{% if not has_products %}
					{% if allow_monthly %}
						<div class="row">
							<div id="type" class="ak-clear ak-err-below large-12 columns">
								<label for="donation_type" class="uppercase">Choose frequency of donation</label>
								<span><input type="radio" name="donation_type" id="id_donation_type_single" value="single" checked><label for="id_donation_type_single"> One-Time Donation<label></span>
								<span><input type="radio" name="donation_type" id="id_donation_type_recurring" value="recurring"><label for="id_donation_type_recurring"> Monthly Donation</label></span>
							</div>
						</div> <!-- .row -->
					{% else %}
						<div id="type" class="ak-clear"></div>
						<input type="hidden" name="donation_type" value="single">
					{% endif %}
				{% endif %}

				<div class="row">
					<div class="contributing-member large-12 columns">
						<label for="user_contributing_member" class="uppercase">Would You Like to Become a Contributing Member of J Street?<span><em>(Optional -</em> <strong>Requires minimum one-time gift of $36 or monthly gift of $10)</strong></span></label>

						<div class="row">
							<div class="large-3 columns">
								<div class="row">
									<div class="large-12 columns">
										<span class="contributing_member_box">
											<input type="radio" name="user_contributing_member" id="contributing_member_yes" data-value="yes"><label for="contributing_member_yes">Yes</label>
										</span>
									</div>

									<div class="large-12 columns">
										<span class="contributing_member_box">
											<input type="radio" name="user_contributing_member" id="contributing_member_no" data-value="no"><label for="contributing_member_no">No</label>
										</span>
									</div>

									<input id="action_contributing_member_field" type="hidden" name="action_contributing_member" value="0" />
								</div>
							</div>

							<div id="jstreet-chapters" class="large-9 columns hidden">
								<label>Do you want to join through a J Street chapter?</label>
								{{page.custom_fields.member_chapters_select|safe}}
							</div> <!-- #jstreet-chapters -->
						</div> <!-- .row -->
					</div> <!-- .contributing-member -->
				</div> <!-- .row -->

				<div class="row">
					<div class="amounts large-12 columns">
						<label for="amount">Choose Donation Amount</label>
						
						<div id="amount_list" class="row ak-err-above">
							{% for amount in amounts %}
								{% ifequal amount "other" %}
									<div id="other_amount_container" class="large-2 medium-4 small-6 columns">
										<noscript><input type="radio" value="" class="amount_radio_button" name="amount"></noscript>
										<label for="amount_other_field" class="ak-btn"><span class="currency_sym">{{ page.currency_sym }}</span> <input type="text" id="amount_other_field" name="amount_other" size="3" onKeypress="clear_radio_buttons();" onClick="update_total()" onBlur="update_total()" onChange="update_total()"></label>
									</div>
								{% else %}
									<div class="large-2 small-3 columns">
										<label for="id_amount_{{amount}}" class="ak-btn"><span class="currency_sym"></span><input type="radio" id="id_amount_{{amount}}" value="{{ amount }}" class="amount_radio_button" name="amount" onClick="clear_other(); update_total()"  onBlur="update_total()" onChange="update_total()" {% if not args.amount_other and amount == default_amount %}checked{% endif %}>{{ page.currency_sym }}{{ amount|commify }}</label>
									</div>
								{% endifequal %}
							{% endfor %}
						</div> <!-- #amount_list -->
					</div> <!-- .amounts -->
				</div> <!-- .row -->

				<div class="row">
					<div class="memory-of large-12 columns">
						<label class="uppercase">Is This Donation in Honor or Memory of Someone?<span><em>(Optional - But for a notification to be sent you must include recipient's mailing address)</em></span></label>

						<div class="row">					
							<div class="large-5 columns">
								<select id="in_honor_of_options" type="text" name="action_inhonorof">
									<option value="">Choose one</option>
									<option value="in_honor">In Honor Of:</option>
									<option value="in_memoriam">In Memoriam:</option>
								</select>
							</div>

							<div class="large-7 columns">
								<input id="honor_name" type="text" name="action_iho" value="" />
							</div>
						</div> <!-- .row -->
					</div> <!-- .memory-of -->
				</div> <!-- .row -->
			</div> <!-- .step-wrapper -->
		</div> <!-- #step-one -->

		<div id="step-two" class="donate-step large-7 columns">
			<div class="step-wrapper">
				<h3 class="step-header">
					<span class="arrow"></span>Step 2</strong>: Enter your information
				</h3> <!-- .step-header -->

				<div class="row basic-info">
					<div class="large-12 columns">
						<label class="uppercase">Your Basic Information</label>
	
						<div class="row ak-labels-overlaid ak-errs-below">
							<div class="large-4 medium-6 columns">
								<label for="first_name">First Name</label>
								<input id="first_name" type="text" name="first_name" class="" />
								<input type="hidden" name="required" value="first_name"/>
							</div>
							
							<div class="large-4 medium-6 columns">
								<label for="last_name">Last Name</label>
								<input id="last_name" type="text" name="last_name" class="" />
								<input type="hidden" name="required" value="last_name"/>
							</div>

							<div class="large-4 medium-6 columns">
								<label class="required" for="email">Email</label>
								<input id="email" type="text" name="email" />
							</div>
						</div> <!-- .row -->
					</div> <!-- .large-12 -->
				</div> <!-- .basic-info -->

				<div class="row billing-info">
					<div class="large-12 columns ak-errs-below">
						<label class="uppercase">Your billing information</label>

						<div class="row ak-errs-below">
							<div class="large-4 medium-6 columns ak-labels-overlaid">
								<label for="address1">Billing address</label>
								<input id="address1" type="text" name="address1" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
							</div>

							<div class="large-4 medium-6 columns ak-labels-overlaid">
								<label for="city">City</label>
								<input id="city" type="text" name="city" onchange="sync_to_shipping()" onblur="sync_to_shipping()" />
							</div>

							<div class="large-2 medium-3 columns">
								{% with 'sync_to_shipping()' as onchange %}{% include "./state_select.html" %}{% endwith %}
							</div>

							<div class="large-2 medium-3 columns ak-labels-overlaid">
								<label for="zip">Zip</label>
								<input id="zip" type="text" name="zip" maxlength="5" size="5" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
							</div>			
						</div> <!-- .row -->		
					</div> <!-- .large-12 -->
				</div> <!-- .billing-info -->

				<div class="row cc-info">
					<div class="large-12 columns">
						<label class="uppercase">Your credit card information</label>

						<div class="row">
							<div class="large-4 medium-6 columns ak-labels-overlaid">
								<label for="card_num">Credit Card #</label>
								<input id="card_num" type="text" name="card_num">
							</div>

							<div class="large-4 medium-6 columns ak-labels-overlaid">
								<label for="card_code">Verification Code</label>
								<input id="card_code" type="text" name="card_code" />
							</div>

							<div class="large-2 medium-3 columns">
								<select id="exp_date_month" type="text" name="exp_date_month">
									<option value="">Exp. Month</option>
									<option value="01">01</option>
									<option value="02">02</option>
									<option value="03">03</option>
									<option value="04">04</option>
									<option value="05">05</option>
									<option value="06">06</option>
									<option value="07">07</option>
									<option value="08">08</option>
									<option value="09">09</option>
									<option value="10">10</option>
									<option value="11">11</option>
									<option value="12">12</option>
								</select>
							</div>

							<div class="large-2 medium-3 columns">
								<select id="exp_date_year" type="text" name="exp_date_year">
									<option value="">Exp. Year</option>
									<option value="15">2015</option>
									<option value="16">2016</option>
									<option value="17">2017</option>
									<option value="18">2018</option>
									<option value="19">2019</option>
									<option value="20">2020</option>
									<option value="21">2021</option>
									<option value="22">2022</option>
									<option value="23">2023</option>
									<option value="24">2024</option>
									<option value="25">2025</option>
									<option value="25">2026</option>
									<option value="25">2027</option>
									<option value="25">2028</option>
									<option value="25">2029</option>
									<option value="25">2030</option>
								</select>
							</div>
						</div> <!-- .row -->
					</div>
				</div> <!-- .cc-info -->

				<div class="row submit">
					<div class="large-12 columns">
						{% if page.payment_processor_information.use_cse %}
							<button disabled="true" type="submit" class="ak-styled-submit-button">Submit Donation</button>
							<noscript>
								<p><b>JavaScript is required</b> so this page can securely submit your donation.</p>
							</noscript>
						{% else %}
							<button type="submit" class="button large alert">Submit Donation</button>
						{% endif %}
					</div>
				</div> <!-- .submit -->

				{% include "./progress_meter.html" %}

				{% if pp.use_cse %}
					<script src="https://js.braintreegateway.com/v1/braintree-data.js"></script>
				{% endif %}
			</div> <!-- .step-wrapper -->
		</div> <!-- #step-two -->
	</div> <!-- .row -->
</form>
{% comment %}
	/*
-------------------------------------------------------------------------------
	@END - Classic Layout Donation Form - Markup
-------------------------------------------------------------------------------
	*/
{% endcomment %}

{% comment %}
	/*
-------------------------------------------------------------------------------
	@START - Donation Popups
-------------------------------------------------------------------------------
	*/
{% endcomment %}
	<script>
		$( document ).ready( function() {
			$( '.popup-close' ).click( function() {
				$( '#donateModal' ).foundation( 'reveal', 'close' );
			});

			$( '#id_donation_type_single' ).click( function() {
				$( '#contributing-ask' ).hide();
				$( '#recurring-ask' ).show();

				{% if args.donation_type %}
				{% else %}
					$( '#donateModal' ).foundation( 'reveal', 'open' );
				{% endif %}
			});

			$( '.popup-recurring-ask' ).click( function() {
				if( $( this ).data( 'value' ) == 'yes' ) {
					$( '#id_donation_type_recurring' ).click();
				}

				$( '#donateModal' ).foundation( 'reveal', 'close' );
			});
		});

		function actionkitValidationErrors(errors, field) {
			console.log( errors );

			if( field ) return;
/*
			for( var name in errors ) {
				errors[name] = '<i class="fa fa-exclamation-triangle"></i>' + errors[name];
			}
*/
			// Remove name from the list of errors
			delete errors['name:missing'];

			// Return that we had an error
			return;
		}

		/*
			Check to make sure that if the user select contributing member, that they are giving enough to qualify
		*/
		function actionkitBeforeSubmit() {
			var anual_min_contribution = 36;
			var min_contribution = $('#id_donation_type_recurring').is(':checked')? anual_min_contribution/12 : 36;
			var other_amount = $('input[name="amount_other"]').val().replace(/\D/g, '');
			var amount_selected = (!isNaN(parseInt(other_amount))) ? parseInt(other_amount) : parseInt($('input[name="amount"]:checked').val());

			if( ( isNaN( amount_selected ) || amount_selected < min_contribution ) && $( '#contributing_member_yes' ).is( ':checked' ) ) {
				$( '#contributing-ask' ).show();
				$( '#recurring-ask' ).hide();

				$( '#donateModal' ).foundation( 'reveal', 'open' );

				return false;
			}
		}
	</script>

	<div id="donateModal" class="reveal-modal tiny" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
		<div id="recurring-ask" class="hidden popup-body">
			<h3>Would you consider making this a recurring donation? You could win a trip to Israel!</h3>
			<p>Sustaining members â€“ contributing even just a few dollars a month - provide J Street with steady, reliable support that propels our movement.</p>
			<p>Donors contributing $10 a month or more will be entered in a raffle to win a free trip to Israel.</p>

			<button class="popup-recurring-ask alert" data-value="yes">Yes, I'll make a monthly donation.</button>
			<button class="popup-recurring-ask" data-value="no">No, I want to give a one-time donation.</button>

			<a class="close-reveal-modal" aria-label="Close">&#215;</a>
		</div> <!-- .popup-body -->

		<div id="contributing-ask" class="hidden popup-body">
			<h3>{{page.custom_fields.min_donation_popup_text|default:"You must donate $36 or more in order to become a contributing member"}}</h3>
		
			<button class="popup-close button large alert">Ok</button>

			<a class="close-reveal-modal" aria-label="Close">&#215;</a>
		</div> <!-- .popup-body -->
	</div> <!-- .reveal-modal --> 
{% comment %}
	/*
-------------------------------------------------------------------------------
	@END - Donation Popups
-------------------------------------------------------------------------------
	*/
{% endcomment %}
{% endblock %}

{% if pp.use_cse %}
	<script src="https://js.braintreegateway.com/v1/braintree-data.js"></script>
{% endif %}

{% block footer %}
{% endblock %}
<!-- @END Development Template/donate.html -->
